<?xml version='1.0'?>

<robot name="bocbot" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Arguments pour personnalisation -->
  <xacro:arg name="robot_name" default="bocbot"/>
  <xacro:arg name="color" default="Blue"/>

  <xacro:property name="robot_name" value="$(arg robot_name)"/>
  <xacro:property name="robot_color" value="$(arg color)"/>

  <xacro:include filename="bocbot.gazebo" />

  <link name="robot_footprint"></link>

  <joint name="robot_footprint_joint" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 0" />
    <parent link="robot_footprint"/>
    <child link="chassis" />
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <!-- CAR BODY - forme de voiture PLUS HAUTE et PLUS COURTE -->
  <link name='chassis'>
    <pose>0 0 0.11 0 0 0</pose>

    <inertial>
      <mass value="100.0"/>
      <origin xyz="0.0 0 -0.02" rpy=" 0 0 0"/>
      <inertia ixx="1.5" ixy="0" ixz="0" iyy="1.5" iyz="0" izz="2.0" />
    </inertial>

    <collision name='collision'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.75 0.6 0.18"/>
      </geometry>
    </collision>

    <visual name='chassis_visual'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.75 0.6 0.18"/>
      </geometry>
    </visual>

  </link>

  <!-- CAPOT (hood) avant de la voiture -->
  <link name="hood">
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
    </inertial>

    <collision name='hood_collision'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.25 0.5 0.10"/>
      </geometry>
    </collision>

    <visual name='hood_visual'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.25 0.5 0.10"/>
      </geometry>
    </visual>
  </link>

  <!-- COFFER (trunk) arriere de la voiture -->
  <link name="trunk">
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
    </inertial>

    <collision name='trunk_collision'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.2 0.5 0.08"/>
      </geometry>
    </collision>

    <visual name='trunk_visual'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.2 0.5 0.08"/>
      </geometry>
    </visual>
  </link>

  <!-- TOIT (roof) de la voiture PLUS HAUT -->
  <link name="roof">
    <inertial>
      <mass value="1.5"/>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
    </inertial>

    <collision name='roof_collision'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.35 0.45 0.12"/>
      </geometry>
    </collision>

    <visual name='roof_visual'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.35 0.45 0.12"/>
      </geometry>
    </visual>
  </link>

  <!-- AILERON (spoiler) arriere style F1 -->
  <link name="spoiler">
    <inertial>
      <mass value="0.5"/>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
    </inertial>

    <!-- Aileron horizontal (wing) -->
    <collision name='spoiler_wing_collision'>
      <origin xyz="0 0 0" rpy=" 0 0.3 0"/>
      <geometry>
        <box size="0.05 0.55 0.02"/>
      </geometry>
    </collision>

    <visual name='spoiler_wing_visual'>
      <origin xyz="0 0 0" rpy=" 0 0.3 0"/>
      <geometry>
        <box size="0.05 0.55 0.02"/>
      </geometry>
    </visual>

    <!-- Supports verticaux de l'aileron -->
    <collision name='spoiler_left_support_collision'>
      <origin xyz="0 -0.22 -0.04" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.08"/>
      </geometry>
    </collision>

    <visual name='spoiler_left_support_visual'>
      <origin xyz="0 -0.22 -0.04" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.08"/>
      </geometry>
    </visual>

    <collision name='spoiler_right_support_collision'>
      <origin xyz="0 0.22 -0.04" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.08"/>
      </geometry>
    </collision>

    <visual name='spoiler_right_support_visual'>
      <origin xyz="0 0.22 -0.04" rpy=" 0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.08"/>
      </geometry>
    </visual>
  </link>

  <!-- ANTENNE pour caméra sur le toit -->
  <link name="antenna">
    <inertial>
      <mass value="0.35"/>
      <origin xyz="-0.25 0 0.30" rpy="0 0 0"/>
      <inertia ixx="0.003" ixy="0" ixz="0" iyy="0.003" iyz="0" izz="0.0003" />
    </inertial>

    <visual name="antenna_visual">
      <origin xyz="0 0 0.30" rpy="0 0 0"/>
      <geometry>
        <cylinder length="0.6" radius="0.02"/>
      </geometry>
    </visual>

    <collision name="antenna_collision">
      <origin xyz="0 0 0.30" rpy="0 0 0"/>
      <geometry>
        <cylinder length="0.6" radius="0.02"/>
      </geometry>
    </collision>

    <visual name="camera_boom_visual">
      <origin xyz="-0.55 0 0.58" rpy="0 0 0"/>
      <geometry>
        <box size="1.10 0.03 0.03"/>
      </geometry>
    </visual>

    <collision name="camera_boom_collision">
      <origin xyz="-0.55 0 0.58" rpy="0 0 0"/>
      <geometry>
        <box size="1.10 0.03 0.03"/>
      </geometry>
    </collision>
  </link>

  <!-- ROUES style voiture (legerement plus grandes) -->
  <link name="front_left_wheel">
    <inertial>
      <mass value="5.0"/>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>

    <visual>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
    </visual>

    <collision>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
      <surface>
        <friction>
          <ode>
            <mu>8.0</mu>
            <mu2>8.0</mu2>
          </ode>
        </friction>
      </surface>
    </collision>
  </link>

  <link name="back_left_wheel">
    <inertial>
      <mass value="5.0"/>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>

    <visual>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
    </visual>

    <collision>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
      <surface>
        <friction>
          <ode>
            <mu>8.0</mu>
            <mu2>8.0</mu2>
          </ode>
        </friction>
      </surface>
    </collision>
  </link>

  <link name="front_right_wheel">
    <inertial>
      <mass value="5.0"/>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>

    <visual>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
    </visual>

    <collision>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
      <surface>
        <friction>
          <ode>
            <mu>8.0</mu>
            <mu2>8.0</mu2>
          </ode>
        </friction>
      </surface>
    </collision>
  </link>

  <link name="back_right_wheel">
    <inertial>
      <mass value="5.0"/>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05" />
    </inertial>

    <visual>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
    </visual>

    <collision>
      <origin xyz="0.0 0 0" rpy=" 0 1.5707 1.5707"/>
      <geometry>
        <cylinder length="0.10" radius="0.085"/>
      </geometry>
      <surface>
        <friction>
          <ode>
            <mu>8.0</mu>
            <mu2>8.0</mu2>
          </ode>
        </friction>
      </surface>
    </collision>
  </link>

  <link name="camera">
    <inertial>
      <mass value="0.1"/>
      <origin xyz="0.05 0.05 0.05" rpy=" 0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
    </inertial>

    <visual name="camera_visual">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.05 0.05 0.05"/>
      </geometry>
    </visual>

    <collision name="camera_colision">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.05 0.05 0.05"/>
      </geometry>
    </collision>
  </link>

  <link name="hokuyo">
    <inertial>
      <mass value="1e-5"/>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
    </inertial>

    <visual name="hokuyo_visual">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <cylinder length="0.08" radius="0.04"/>
      </geometry>
    </visual>

    <collision name="hokuyo_colision">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <cylinder length="0.08" radius="0.04"/>
      </geometry>
    </collision>
  </link>

  <!-- CAMERAS 360° - 4 mini-cameras sur l'antenne, INVISIBLES -->
  <link name="cam360_front">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7" />
    </inertial>
    <!-- PAS DE VISUAL - cameras invisibles dans Gazebo -->
  </link>

  <link name="cam360_right">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7" />
    </inertial>
  </link>

  <link name="cam360_back">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7" />
    </inertial>
  </link>

  <link name="cam360_left">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7" />
    </inertial>
  </link>

  <!-- JOINTS pour les roues - positions larges style voiture -->
  <joint type="continuous" name="front_left_wheel_joint">
    <origin xyz="0.30 0.32 -0.05" rpy="0 0 0"/>
    <child link="front_left_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
    <limit effort="20000" velocity="1000"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>

  <joint type="continuous" name="front_right_wheel_joint">
    <origin xyz="0.30 -0.32 -0.05" rpy="0 0 0"/>
    <child link="front_right_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
    <limit effort="20000" velocity="1000"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>

  <joint type="continuous" name="back_left_wheel_joint">
    <origin xyz="-0.30 0.32 -0.05" rpy="0 0 0"/>
    <child link="back_left_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
    <limit effort="20000" velocity="1000"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>

  <joint type="continuous" name="back_right_wheel_joint">
    <origin xyz="-0.30 -0.32 -0.05" rpy="0 0 0"/>
    <child link="back_right_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
    <limit effort="20000" velocity="1000"/>
    <dynamics damping="1.0" friction="1.0"/>
  </joint>

  <!-- JOINTS pour capot, coffre, toit et aileron -->
  <joint type="fixed" name="hood_joint">
    <origin xyz="0.50 0 0" rpy="0 0 0"/>
    <child link="hood"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <joint type="fixed" name="trunk_joint">
    <origin xyz="-0.48 0 0" rpy="0 0 0"/>
    <child link="trunk"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <joint type="fixed" name="roof_joint">
    <origin xyz="0.05 0 0.15" rpy="0 0 0"/>
    <child link="roof"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <joint type="fixed" name="spoiler_joint">
    <origin xyz="-0.55 0 0.22" rpy="0 0 0"/>
    <child link="spoiler"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <!-- ANTENNE - Sur le toit pour la caméra -->
  <joint type="fixed" name="antenna_joint">
    <origin xyz="-0.10 0 0.16" rpy="0 0 0"/>
    <child link="antenna"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <!-- CAMÉRA - Sur perche arriere pour vue 3e personne -->
  <joint type="fixed" name="camera_joint">
    <origin xyz="-1.35 0 0.62" rpy="0 0.20 0"/>
    <child link="camera"/>
    <parent link="antenna"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
  </joint>

  <!-- Joints cameras 360 - sur l'antenne a z=0.30 (meme hauteur que le LIDAR) -->
  <joint type="fixed" name="cam360_front_joint">
    <origin xyz="0.02 0 0.30" rpy="0 0 0"/>
    <child link="cam360_front"/>
    <parent link="antenna"/>
  </joint>

  <joint type="fixed" name="cam360_right_joint">
    <origin xyz="0 -0.02 0.30" rpy="0 0 -1.5708"/>
    <child link="cam360_right"/>
    <parent link="antenna"/>
  </joint>

  <joint type="fixed" name="cam360_back_joint">
    <origin xyz="-0.02 0 0.30" rpy="0 0 3.1416"/>
    <child link="cam360_back"/>
    <parent link="antenna"/>
  </joint>

  <joint type="fixed" name="cam360_left_joint">
    <origin xyz="0 0.02 0.30" rpy="0 0 1.5708"/>
    <child link="cam360_left"/>
    <parent link="antenna"/>
  </joint>

  <!-- LIDAR 360° - Au sommet de l'antenne pour vision 360° dégagée -->
  <joint type="fixed" name="hokuyo_joint">
    <origin xyz="0 0 0.30" rpy="0 0 0"/>
    <child link="hokuyo"/>
    <parent link="antenna"/>
    <axis xyz="0 0 1" rpy="0 0 0"/>
  </joint>

  <!-- MATERIAUX GAZEBO - Couleurs selon l'equipe -->
  <xacro:if value="${robot_color == 'Orange'}">
    <!-- Robot ORANGE -->
    <gazebo reference="chassis">
      <material>Gazebo/Orange</material>
    </gazebo>
    <gazebo reference="hood">
      <material>Gazebo/Orange</material>
    </gazebo>
    <gazebo reference="trunk">
      <material>Gazebo/Orange</material>
    </gazebo>
    <gazebo reference="roof">
      <material>Gazebo/Orange</material>
    </gazebo>
  </xacro:if>

  <xacro:if value="${robot_color == 'Blue'}">
    <!-- Robot BLEU -->
    <gazebo reference="chassis">
      <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="hood">
      <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="trunk">
      <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="roof">
      <material>Gazebo/Blue</material>
    </gazebo>
  </xacro:if>

  <!-- Spoiler: couleur de l'equipe -->
  <gazebo reference="spoiler">
    <material>Gazebo/${robot_color}</material>
  </gazebo>

  <gazebo reference="antenna">
    <material>Gazebo/Black</material>
  </gazebo>

  <gazebo reference="front_left_wheel">
    <material>Gazebo/Black</material>
  </gazebo>

  <gazebo reference="front_right_wheel">
    <material>Gazebo/Black</material>
  </gazebo>

  <gazebo reference="back_left_wheel">
    <material>Gazebo/Black</material>
  </gazebo>

  <gazebo reference="back_right_wheel">
    <material>Gazebo/Black</material>
  </gazebo>

  <gazebo reference="camera">
    <material>Gazebo/White</material>
  </gazebo>

  <gazebo reference="hokuyo">
    <material>Gazebo/${robot_color}</material>
  </gazebo>

  <gazebo reference="cam360_front">
    <material>Gazebo/Red</material>
  </gazebo>

  <gazebo reference="cam360_right">
    <material>Gazebo/Red</material>
  </gazebo>

  <gazebo reference="cam360_back">
    <material>Gazebo/Red</material>
  </gazebo>

  <gazebo reference="cam360_left">
    <material>Gazebo/Red</material>
  </gazebo>

</robot>
